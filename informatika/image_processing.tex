\subsection{Image processing}

Táto kapitola bude venovaná spracovaniu obrazovej informácie a ako sa
pri tom dá využiť Fourierova transformácia. Ukážeme si dôležitosť
magnitúdy a fázy, rýchle hľadanie patternu rovnakej
veľkosti a orientácie a watermarking. O digitálnych filtroch pre
obrazovú informáciu sme už písali v predchádzajúcej kapitole a tak ich
láskavo preskočíme.

\subsubsection{Fourierova transformácia - fáza a magnitúda}


\subsubsection{Hľadanie patternov}
Jednou z nečakaných aplikácii konvolúcie je aj takzvaný korelačný
filter. Korelácia sa používa na identifikáciu lineárnej závislosti.
Začneme štandardnou definíciou korelácie zo štatistiky
\begin{definicia}[Korelácia]
  Koreláciou 2 nenulových postupností $x,y$ nazveme číslo
  \begin{equation}
    r_{x,y} = \frac{E(xy)-E(x)E(y)}{D(x)D(y)} =
        \frac{n \sum x_i y_i - \sum x_i \sum y_i}{
        \sqrt{n \sum x_i^2 - (\sum x_i)^2}
        \sqrt{n \sum y_i^2 - (\sum y_i)^2}}
  \end{equation}
\end{definicia}
Korelácia popisuje mieru lineárnej závislosti oboch postupností.
Použitím Cauchy-Schwarzovej nerovnosti pomerne jednoducho dostávame
nerovnosť $|r_{x,y}| \le 1$ s rovnosťou nastávajúcou práve v prípade
lineárnej závislosti. Zjednodušene povedané, čím je väčšia korelácia
(v absolútnej hodnote), tým viac sa na seba dané postupnosti podobajú,
zoberúc do úvahy ich relatívne škálovanie. Korelácia je preto veľmi
vhodný nástroj v spracovávaní signálu na hľadanie známej vzorky v
danom signáli. Musíme ale nájsť efektívnu cestu ako ju rýchlo počítať.
\begin{definicia}[Nenormalizovaná korelácia]
    Nenormalizovanou koreláciou nazveme hodnotu
    \begin{equation}
        r'_{x,y} = \sum_{i=0}^{n-1} x_i t_y
    \end{equation}
\end{definicia}
Čakajú nás 2 podúlohy - rýchlo počítanie nenormalizovanej korelácie a
následne efektívny prepočet na normalizovanú koreláciu.
Aby sme spresnili úlohu - na vstupe máme známy pattern $y_0,\dots,y_{n-1}$
dĺžky $n$ a signál (pravdepodobne) väčšej dĺžky $x_0,\dots, x_{m-1}$.
Chceme vypočítať postupne
$r_{x_0\dots x_{n-1},y}, r_{x_1\dots x_n,y}, r_{x_2\dots x_{n+1},y},\dots$.
Pretože zameraním celej tento práce je Fourierova transformácia,
dostávame drobný hint. Konkrétne, poznáme podobnú rovnicu - konvolúciu.
Skutočne, konvolúcia a korelácia sú jedna a tá istá operácia, ak
"otočíme" postupnosť $y$.
Formálne
\begin{lema}
    Nech $x'$ je postupnosť $x$ rozšírená nulami na dĺžku $n+m$.
    Nech $y'$ je postupnosť dĺžky $n+m$ definovaná nasledovne
        $y'[]=y_0, 0 \textit{ $m$ krát}, y_{n-1}, y_{n-2}, \dots, y_2, y_1$.
    Potom $r_{x_i,y} = conv(x,y)_i$ kde $conv$ označuje (cyklickú)
    konvolúcia.
\end{lema}
Nenormalizovanú korelácie vieme preto rýchlo počítať pomocou
Fourierovej transformácie. Ostáva určiť, ako ju efektívne prepočítať
na normalizovanú.
Prvým krokom bude "normalizácia" $y$ vzorcom $y' = y-E(y)$, inak povedané,
odčítanie priemeru. Táto transformácia nezmení hodnotu korelácie, ako
sa môžeme presvedčiť
\begin{align}
    E(x (y-E(y))) = E(x y - x E(y)) = E(xy) - E(x E(y)) = E(xy) -
    E(x)E(y) \\
    D(y - E(y)) = D(y)
\end{align}
V čitateľi ostala nenormalizovaná korelácia $x,y'$, v menovateli
konštantná hodnota $D(y)$ ľahko vypočítateľná na začiatku a $D(x)=
D(\{x_i,x_{i+1},\dots,x_{i+n-1})$,
ktorá sa mení. Našťastie, táto hodnota sa dá efektívne počítať. V
jednom rozmere napríklad nasledovne - držíme su sumu posledných $n$
hodnôt a ich druhých mocnín a keď sa posúvame o 1 vpravo, pripočítame
nový člen a odpočítame hodnotu toho, ktorý "vypadol" z postupnosti. V
dvoch (a viacerých) rozmeroch sa dajú predpočítať prefixové sumy v
lineárnom čase s následnou otázkou na sumu obdĺžnika v konštantnom
čase.

Po vyriešení algoritmickej strany problému sa zamyslíme na čo je
korelácia vhodná. Jedno teoretické použitie ze znázornené na obrázku
\ref{fig:korelacia}. Ide o stroj overujíci pravosť bankovky a
hľadajúci známe znaky. Na obrázku je znázornený známy pattern, ktorý
chceme identifikovať v rámci obrázku, symbol eura. Vedľa neho je
znázornená korelácia daných dvoch vzorov, ukazujúca maximum presne na
polohe hľadaného symbolu. Stroj takto môže identifikovať viacero
symbolov, porovnať ich pozície a kvalitu korelácie a identifikovať
bankovku.
\begin{figure}[htp]
    \subfigure[Pattern]{
    \includegraphics{obrazky/informatika/image_processing/korelacia/pattern}
    }
    \subfigure[Bankovka]{
    \includegraphics{obrazky/informatika/image_processing/korelacia/source}
    }
    \subfigure[Korelácia]{
    \includegraphics{obrazky/informatika/image_processing/korelacia/correlation}
    }
    \caption{Ukážka korelácie}
    \label{fig:korelacia}
\end{figure}

Na prvý pohľad sa teda zdá, že korelácia je spása a dokonalý nástroj
na hľadanie paternov. Daný prístup má však svoje nedostatky. V jednom
rozmere je to neschopnosť detekcie signálu, ktorý je "roztiahnutý". V
dvoch rozmeroch k škálovaniu pribúda aj otočenie. Zjavne, korelácia hľadá len
pattern presnej veľkosti a presného natočenia, čo môže byť výrazným
problémom pri hľadaní patternu vo všeobecnej polohe. Aj napriek týmto
nedostatkom je však použiteľná na veľkú škálu problémov, ako sme si
ukázali na príklade.

\todo{lit:}
%DSP guide

\subsubsection{Watermarking}
